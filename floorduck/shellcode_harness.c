#include <string.h>
#include <sys/mman.h>
#include <stdio.h>

// make with -g -Wall -fno-stack-protector -z execstack

// add -m32 if 32 bit, none if 64 bit
unsigned char shellcode_32[] = {
  0xe8, 0x13, 0x00, 0x00, 0x00, 0x46, 0x6c, 0x6f, 0x6f, 0x72, 0x64, 0x75,
  0x63, 0x6b, 0x20, 0x53, 0x75, 0x63, 0x6b, 0x73, 0x20, 0x33, 0x32, 0x0a,
  0x31, 0xc0, 0xb0, 0x04, 0x31, 0xdb, 0xb3, 0x01, 0x59, 0x31, 0xd2, 0xb2,
  0x13, 0xcd, 0x80, 0x31, 0xc0, 0xb0, 0x01, 0x31, 0xdb, 0xb3, 0x01, 0xcd,
  0x80
};

int main(int argc, char **argv)
{
    void *mem = mmap(0, sizeof(shellcode_32), PROT_READ|PROT_WRITE, MAP_SHARED|MAP_ANONYMOUS, -1, 0);
    memcpy(mem, shellcode_32, sizeof(shellcode_32));
    mprotect(mem, sizeof(shellcode_32), PROT_READ|PROT_WRITE|PROT_EXEC);

    int (*func)();
    func = (int (*)())mem;
    (int)(*func)();

    munmap(mem, sizeof(shellcode_32));

    return 0;
}
